{% extends "base.html" %}

{% block page_title %}Topluluk AkÄ±ÅŸÄ±{% endblock %}

{% block content %}

<div style="max-width: 800px; margin: 0 auto;">

  <!-- PaylaÅŸÄ±m Yapma KartÄ± -->
  {% if current_user.is_authenticated %}
  <div class="card">
    <div style="display: flex; gap: 1rem;">
      <div class="avatar-small" style="width: 45px; height: 45px; font-size: 1.2rem;">{{ current_user.username[0]|upper
        }}</div>
      <div style="flex: 1;">
        <form method="POST" action="{{ url_for('community.create_post') }}">
          <textarea name="content" class="form-control" rows="3"
            placeholder="ğŸ’¦ Su tasarrufu ipucunu veya baÅŸarÄ±mÄ±nÄ± paylaÅŸ..."
            style="resize: none; border: none; background: #f8fafc;" required></textarea>
          <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
            <button type="submit" class="btn btn-primary">
              <i class="fa-solid fa-paper-plane"></i> PaylaÅŸ
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  {% else %}
  <div class="card" style="text-align: center; padding: 3rem;">
    <h3>TopluluÄŸa KatÄ±lÄ±n</h3>
    <p>Deneyimlerinizi paylaÅŸmak ve diÄŸer Ã¼yelerden ilham almak iÃ§in giriÅŸ yapÄ±n.</p>
    <div style="margin-top: 20px;">
      <a href="{{ url_for('community.login') }}" class="btn btn-primary">GiriÅŸ Yap</a>
      <a href="{{ url_for('community.register') }}" class="btn btn-secondary">KayÄ±t Ol</a>
    </div>
  </div>
  {% endif %}

  <!-- GÃ¶nderiler -->
  <div class="feed-list">
    {% for post in posts %}
    <div class="card post-item">
      <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
        <div style="display: flex; gap: 10px; align-items: center;">
          <div class="avatar-small" style="background-color: var(--secondary);">{{ post.user.username[0]|upper }}</div>
          <div>
            <div style="font-weight: 600; color: var(--text-main);">{{ post.user.username }}</div>
            <div style="font-size: 0.8rem; color: var(--text-light);">Ãœye</div>
          </div>
        </div>
        <!-- Opsiyonel: Tarih eklenebilir -->
      </div>

      <p style="font-size: 1.05rem; margin-bottom: 1.5rem;">{{ post.content }}</p>

      <div
        style="border-top: 1px solid var(--border); padding-top: 10px; display: flex; align-items: center; gap: 15px;">
        {% if current_user.is_authenticated %}
        <form method="POST" action="{{ url_for('community.like_post', post_id=post.id) }}" style="display: inline;">
          <button type="submit" class="btn btn-like {% if post.likes > 0 %}liked{% else %}unliked{% endif %}">
            <i class="fa-solid fa-heart"></i> {{ post.likes or 0 }}
          </button>
        </form>
        {% else %}
        <span style="color: var(--text-muted);"><i class="fa-solid fa-heart"></i> {{ post.likes or 0 }} BeÄŸeni</span>
        {% endif %}
      </div>
    </div>
    {% endfor %}

    {% if not posts %}
    <div style="text-align: center; color: var(--text-light); margin-top: 50px;">
      <i class="fa-regular fa-comments" style="font-size: 3rem; margin-bottom: 10px;"></i>
      <p>HenÃ¼z gÃ¶nderi yok. Ä°lk paylaÅŸÄ±mÄ± sen yap!</p>
    </div>
    {% endif %}
  </div>

</div>

{% endblock %}